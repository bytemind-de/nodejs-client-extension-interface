<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<!-- web app settings -->
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=0">
	<!-- Title, icons and colors -->
	<title>Server</title>
	<meta name="application-name" content="Server"/>
	<meta name="apple-mobile-web-app-title" content="Server">
	<meta name="description" content="Server test-page">
	<meta name="theme-color" content="#000">
	<!-- Icons
	<link rel="icon" sizes="192x192" href="img/icon.png">
	<link rel="apple-touch-icon" href="img/icon.png">
	<meta property="og:image" content="img/icon.png"/>
	-->
	<!-- imports -->
	<!--
	<script type="text/javascript" src="js/jquery-3.1.1.min.js" charset="UTF-8"></script>
	<link rel="stylesheet" href="css/main.css">
	-->
	<style>
	</style>
</head>
<body>
	<div>
		Hello World
	</div>
	<div>
		<button onclick="connectToWebsocket()">Connect</button>
		<button onclick="closeWebsocketConnection()">Close</button>
		<button onclick="websocketSendPing()">Ping</button>
		<button onclick="websocketSendToBleBeaconScanner()">Ping BLE Beacon Scanner</button>
	</div>
	<div id="log-out"></div>
	<script>
		//Websocket test
		var ws;
		var msgId = 0;
		function connectToWebsocket(){
			var logOut = document.getElementById('log-out');
			var host;
			if (location.origin.indexOf("https") == 0){
				host = location.origin.replace(/^https/, 'wss');
			}else{
				host = location.origin.replace(/^http/, 'ws');
			}
			
			ws = new WebSocket(host);
			
			ws.onopen = function(event){
				console.log("Client connected.");
				logOut.innerHTML += ("Client connected.<br>");
			};
			
			ws.onmessage = function(msg){
				console.log(msg.data);
				logOut.innerHTML += (msg.data + "<br>");
			};
			
			ws.onerror = function(error){
				console.log("WS error: " + error);
				logOut.innerHTML += ("WS error: " + error + "<br>");
			};
			
			ws.onclose = function(event){
				console.log("Connection closed.");
				logOut.innerHTML += ("Connection closed.<br>");
			};
			
			console.log("Connecting...");
			logOut.innerHTML += ("Connecting...<br>");
		}
		function closeWebsocketConnection(){
			if (ws){
				ws.close();
			}
		}
		function websocketSendPing(){
			if (ws){
				var msg = {
					type: "msg",
					text: "ping",
					id: ++msgId,
					date: Date.now()
				};
				// Send the msg object as a JSON-formatted string.
				ws.send(JSON.stringify(msg));
			}
		}
		function websocketSendToBleBeaconScanner(){
			if (ws){
				var msg = {
					type: "ble-beacon-scanner",
					data: "ping",
					id: ++msgId,
					date: Date.now()
				};
				// Send the msg object as a JSON-formatted string.
				ws.send(JSON.stringify(msg));
			}
		}
	</script>
</body>
</html>
